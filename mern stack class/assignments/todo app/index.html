<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TODO – Local Storage</title>
  <style>
    :root{
      --bg: #0f1220;
      --bg-elev: #14182a;
      --card: #191f36;
      --muted: #8b93a7;
      --text: #e6e8ef;
      --accent: #6ee7b7; /* mint */
      --accent-2: #60a5fa; /* blue */
      --danger: #f87171; /* red */
      --warn: #f59e0b; /* amber */
      --ok: #34d399; /* green */
      --ring: rgba(110,231,183,.35);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 600px at 10% -10%, #1a2140 10%, transparent 60%),
                  radial-gradient(900px 600px at 110% 10%, #112032 10%, transparent 60%),
                  var(--bg);
      color: var(--text);
      display:flex; flex-direction:column; gap:16px;
    }

    header{
      position: sticky; top:0; backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(10,12,22,.85), rgba(10,12,22,.6));
      border-bottom: 1px solid rgba(255,255,255,.06);
      z-index: 10;
    }

    .container{max-width: 980px; margin: 0 auto; padding: 18px}

    .appbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.3px }
    .brand .logo{
      width:36px;height:36px;border-radius:12px; display:grid; place-items:center;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
      color:#091018; font-weight:900; box-shadow: var(--shadow);
    }
    .brand span{opacity:.95}

    .stats{display:flex; gap:10px; font-size:.9rem; color:var(--muted)}
    .stats .pill{ padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08)}

    main{ flex:1; }

    .grid{ display:grid; grid-template-columns: 1.1fr .9fr; gap:18px }
    @media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

    .card{ background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
           border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow); }

    .card .card-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:18px; border-bottom:1px solid rgba(255,255,255,.06)}
    .card .card-body{ padding:18px }

    .input-row{ display:grid; grid-template-columns: 1fr 130px 160px; gap:10px }
    @media (max-width: 700px){ .input-row{ grid-template-columns: 1fr; } }

    .field{ position:relative }
    .field input, .field select, .field textarea{
      width:100%; background: var(--bg-elev); border:1px solid rgba(255,255,255,.08); color:var(--text);
      padding:12px 14px; border-radius:12px; outline:none; box-shadow: inset 0 -30px 40px rgba(255,255,255,.02);
    }
    .field textarea{ min-height: 86px; resize: vertical }
    .field input:focus, .field select:focus, .field textarea:focus{ border-color: var(--accent); box-shadow: 0 0 0 6px var(--ring) }

    .btn{ border:none; cursor:pointer; border-radius:12px; padding:12px 16px; font-weight:600; color:#0a101a;
          background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%); box-shadow: var(--shadow); }
    .btn:disabled{ filter:saturate(.6) brightness(.85); cursor:not-allowed }

    .btn-ghost{ background: transparent; color: var(--text); border:1px solid rgba(255,255,255,.12) }
    .btn-danger{ background: linear-gradient(135deg, #fda4af, #f87171); color:#1b0c0c }

    .toolbar{ display:flex; flex-wrap: wrap; gap:10px }

    /* Tabs / filters */
    .tabs{ display:flex; gap:8px; flex-wrap:wrap }
    .tab{ padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.12); color:var(--muted); cursor:pointer; user-select:none }
    .tab.active{ color: var(--text); border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring) }

    /* List */
    .list{ display:flex; flex-direction:column; gap:10px }
    .todo{ background: var(--card); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:12px; display:grid; grid-template-columns: auto 1fr auto; align-items:start; gap:12px }
    .todo.completed{ opacity:.7 }

    .checkbox{ width:20px;height:20px; border-radius:6px; background:var(--bg-elev); border:2px solid rgba(255,255,255,.14); display:grid; place-items:center; cursor:pointer }
    .checkbox input{ appearance:none; width:0;height:0;margin:0;padding:0 }
    .checkbox .dot{ width:12px;height:12px; border-radius:4px; display:none; background:var(--ok) }
    .todo.completed .checkbox .dot{ display:block }

    .todo-title{ font-weight:700 }
    .todo-meta{ display:flex; gap:8px; flex-wrap:wrap; font-size:.85rem; color:var(--muted) }

    .badge{ padding:4px 8px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12) }
    .badge.prio-low{ border-color:#86efac33 }
    .badge.prio-medium{ border-color:#60a5fa55 }
    .badge.prio-high{ border-color:#f9731655 }
    .badge.overdue{ border-color:#f87171aa; color:#fecaca }

    .todo-actions{ display:flex; gap:8px }
    .icon-btn{ background: transparent; border:1px solid rgba(255,255,255,.12); color: var(--text); border-radius:10px; padding:8px; cursor:pointer }
    .icon-btn:hover{ border-color: var(--accent) }

    .empty{ text-align:center; color: var(--muted); border:1px dashed rgba(255,255,255,.16); padding:24px; border-radius:16px }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }

    footer{ text-align:center; color:var(--muted); font-size:.9rem; padding:20px }
  </style>
</head>
<body>
  <header>
    <div class="container appbar" role="banner">
      <div class="brand">
        <div class="logo" aria-hidden="true">✓</div>
        <span>Minimal TODO</span>
      </div>
      <div class="stats" aria-live="polite">
        <div class="pill" id="stat-total">0 total</div>
        <div class="pill" id="stat-active">0 active</div>
        <div class="pill" id="stat-done">0 completed</div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Add / Edit Card -->
      <section class="card" aria-labelledby="form-title">
        <div class="card-head">
          <h2 id="form-title" style="margin:0">Add a new TODO</h2>
          <div class="toolbar">
            <button id="clear-completed" class="btn-ghost" title="Delete completed todos">Clear completed</button>
            <button id="clear-all" class="btn-danger" title="Delete ALL todos">Delete all</button>
          </div>
        </div>
        <div class="card-body">
          <form id="todo-form">
            <div class="field" style="margin-bottom:10px">
              <label class="sr-only" for="title">Title</label>
              <input id="title" name="title" type="text" placeholder="e.g. Study JavaScript array methods" required minlength="2" />
            </div>

            <div class="input-row" style="margin-bottom:10px">
              <div class="field">
                <label class="sr-only" for="notes">Notes</label>
                <textarea id="notes" name="notes" placeholder="Optional notes, links, checklist…"></textarea>
              </div>
              <div class="field">
                <label class="sr-only" for="priority">Priority</label>
                <select id="priority" name="priority">
                  <option value="low">Low priority</option>
                  <option value="medium" selected>Medium priority</option>
                  <option value="high">High priority</option>
                </select>
              </div>
              <div class="field">
                <label class="sr-only" for="due">Due date</label>
                <input id="due" name="due" type="date" />
              </div>
            </div>

            <div class="toolbar">
              <button class="btn" type="submit">Add TODO</button>
              <button class="btn-ghost" type="reset">Reset</button>
            </div>
          </form>
        </div>
      </section>

      <!-- List / Filters Card -->
      <section class="card" aria-labelledby="list-title">
        <div class="card-head" style="gap:14px; align-items:start">
          <div>
            <h2 id="list-title" style="margin:0">Your TODOs</h2>
            <div class="tabs" id="filters" role="tablist" aria-label="Filters">
              <div class="tab active" role="tab" data-filter="all" tabindex="0">All</div>
              <div class="tab" role="tab" data-filter="active" tabindex="0">Active</div>
              <div class="tab" role="tab" data-filter="completed" tabindex="0">Completed</div>
              <div class="tab" role="tab" data-filter="overdue" tabindex="0">Overdue</div>
            </div>
          </div>
          <div class="toolbar" style="margin-left:auto">
            <div class="field">
              <label class="sr-only" for="search">Search</label>
              <input id="search" type="search" placeholder="Search titles & notes" />
            </div>
            <div class="field">
              <label class="sr-only" for="sort">Sort</label>
              <select id="sort">
                <option value="created-desc">Newest first</option>
                <option value="created-asc">Oldest first</option>
                <option value="priority-desc">Priority (high→low)</option>
                <option value="priority-asc">Priority (low→high)</option>
                <option value="due-asc">Due date (earliest)</option>
                <option value="due-desc">Due date (latest)</option>
              </select>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div id="list" class="list" aria-live="polite"></div>
          <div id="empty" class="empty" hidden>
            Nothing here yet. Add your first TODO from the form on the left!
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    Built with ❤️. Your tasks persist in your browser via Local Storage.
  </footer>

  <template id="todo-template">
    <article class="todo" data-id="">
      <label class="checkbox" title="Toggle complete">
        <input type="checkbox" />
        <span class="dot"></span>
      </label>
      <div>
        <div class="todo-title"></div>
        <div class="todo-meta"></div>
        <div class="todo-notes" style="white-space:pre-wrap; opacity:.95; margin-top:6px"></div>
      </div>
      <div class="todo-actions">
        <button class="icon-btn edit" title="Edit">✎</button>
        <button class="icon-btn del" title="Delete">🗑</button>
      </div>
    </article>
  </template>

  <dialog id="edit-dialog">
    <form method="dialog" id="edit-form" style="min-width: min(520px, 90vw); background: var(--card); color:var(--text); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:16px">
      <h3 style="margin-top:0">Edit TODO</h3>
      <input type="hidden" id="edit-id" />
      <div class="field" style="margin-bottom:10px"><input id="edit-title" type="text" required /></div>
      <div class="field" style="margin-bottom:10px"><textarea id="edit-notes"></textarea></div>
      <div class="input-row" style="margin-bottom:10px">
        <div class="field"><select id="edit-priority"><option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option></select></div>
        <div class="field"><input id="edit-due" type="date" /></div>
      </div>
      <div class="toolbar" style="justify-content:flex-end">
        <button class="btn-ghost" value="cancel">Cancel</button>
        <button class="btn" value="save">Save</button>
      </div>
    </form>
  </dialog>

  <script>
    // --- Utilities ---
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const fmtDate = (iso) => iso ? new Date(iso + 'T00:00:00').toLocaleDateString() : '';
    const todayISO = () => new Date().toISOString().slice(0,10);

    // --- Storage Layer ---
    const STORAGE_KEY = 'minimal_todo.items.v1';
    const load = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) ?? []; } catch { return []; }
    };
    const save = (items) => localStorage.setItem(STORAGE_KEY, JSON.stringify(items));

    // --- State ---
    let state = {
      items: load(),
      filter: 'all',
      search: '',
      sort: 'created-desc'
    };

    // --- Derived helpers ---
    const isOverdue = (t) => t.due && !t.completed && t.due < todayISO();
    const prioRank = (p) => ({ high:3, medium:2, low:1 }[p] ?? 0);

    // --- CRUD operations ---
    function addTodo({title, notes='', priority='medium', due=''}){
      const item = { id: crypto.randomUUID(), title:title.trim(), notes, priority, due, completed:false, createdAt: Date.now() };
      state.items.unshift(item); // newest first by default
      save(state.items); render();
    }

    function updateTodo(id, patch){
      const i = state.items.findIndex(t => t.id === id); if(i===-1) return;
      state.items[i] = { ...state.items[i], ...patch };
      save(state.items); render();
    }

    function deleteTodo(id){
      state.items = state.items.filter(t => t.id !== id);
      save(state.items); render();
    }

    function clearCompleted(){ state.items = state.items.filter(t => !t.completed); save(state.items); render(); }
    function clearAll(){ state.items = []; save(state.items); render(); }

    // --- Rendering ---
    function render(){
      // stats
      const total = state.items.length;
      const done = state.items.filter(t=>t.completed).length;
      const active = total - done;
      $('#stat-total').textContent = `${total} total`;
      $('#stat-active').textContent = `${active} active`;
      $('#stat-done').textContent = `${done} completed`;

      // filter/search/sort
      let view = state.items.slice();
      if(state.filter==='active') view = view.filter(t=>!t.completed);
      if(state.filter==='completed') view = view.filter(t=>t.completed);
      if(state.filter==='overdue') view = view.filter(isOverdue);
      if(state.search){
        const q = state.search.toLowerCase();
        view = view.filter(t => t.title.toLowerCase().includes(q) || (t.notes||'').toLowerCase().includes(q));
      }
      const by = state.sort;
      view.sort((a,b)=>{
        switch(by){
          case 'created-asc': return a.createdAt - b.createdAt;
          case 'created-desc': return b.createdAt - a.createdAt;
          case 'priority-desc': return prioRank(b.priority) - prioRank(a.priority);
          case 'priority-asc': return prioRank(a.priority) - prioRank(b.priority);
          case 'due-asc': return (a.due||'9999-99-99').localeCompare(b.due||'9999-99-99');
          case 'due-desc': return (b.due||'0000-00-00').localeCompare(a.due||'0000-00-00');
          default: return 0;
        }
      });

      const list = $('#list'); list.innerHTML = '';
      $('#empty').hidden = view.length !== 0;

      for(const t of view){
        const tpl = $('#todo-template').content.cloneNode(true);
        const el = tpl.querySelector('.todo');
        el.dataset.id = t.id;
        if(t.completed) el.classList.add('completed');
        const cb = tpl.querySelector('input[type="checkbox"]');
        cb.checked = t.completed;
        cb.setAttribute('aria-label', `Mark ${t.title} ${t.completed? 'incomplete' : 'complete'}`);

        const titleEl = tpl.querySelector('.todo-title');
        titleEl.textContent = t.title;

        const meta = tpl.querySelector('.todo-meta');
        const badges = [];
        badges.push(`<span class="badge prio-${t.priority}">Priority: ${t.priority}</span>`);
        if(t.due){
          const overdue = isOverdue(t);
          badges.push(`<span class="badge ${overdue?'overdue':''}">Due: ${fmtDate(t.due)}${overdue ? ' • Overdue' : ''}</span>`);
        }
        badges.push(`<span class="badge">${new Date(t.createdAt).toLocaleString()}</span>`);
        meta.innerHTML = badges.join(' ');

        const notes = tpl.querySelector('.todo-notes');
        notes.textContent = t.notes || '';

        list.appendChild(tpl);
      }
    }

    // --- Event wiring ---
    $('#todo-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const title = $('#title').value;
      const notes = $('#notes').value;
      const priority = $('#priority').value;
      const due = $('#due').value;
      addTodo({title, notes, priority, due});
      e.target.reset();
      $('#title').focus();
    });

    $('#clear-completed').addEventListener('click', ()=>{
      if(confirm('Delete all completed todos?')) clearCompleted();
    });
    $('#clear-all').addEventListener('click', ()=>{
      if(confirm('This will delete ALL todos. Continue?')) clearAll();
    });

    // Toggle complete, delete, edit (event delegation)
    $('#list').addEventListener('click', (e)=>{
      const article = e.target.closest('.todo');
      if(!article) return;
      const id = article.dataset.id;

      if(e.target.closest('.checkbox')){
        const t = state.items.find(x=>x.id===id);
        updateTodo(id, { completed: !t.completed });
      }
      else if(e.target.closest('.del')){
        if(confirm('Delete this todo?')) deleteTodo(id);
      }
      else if(e.target.closest('.edit')){
        const t = state.items.find(x=>x.id===id);
        $('#edit-id').value = t.id;
        $('#edit-title').value = t.title;
        $('#edit-notes').value = t.notes || '';
        $('#edit-priority').value = t.priority;
        $('#edit-due').value = t.due || '';
        $('#edit-dialog').showModal();
      }
    });

    // Edit dialog save/cancel
    $('#edit-dialog').addEventListener('close', ()=>{
      if($('#edit-dialog').returnValue === 'save'){
        const id = $('#edit-id').value;
        updateTodo(id, {
          title: $('#edit-title').value,
          notes: $('#edit-notes').value,
          priority: $('#edit-priority').value,
          due: $('#edit-due').value,
        });
      }
    });

    // Filters
    $('#filters').addEventListener('click', (e)=>{
      const tab = e.target.closest('.tab'); if(!tab) return;
      $$('.tab', $('#filters')).forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      state.filter = tab.dataset.filter; render();
    });
    // Keyboard activation for tabs
    $$('#filters .tab').forEach(tab=>{
      tab.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); tab.click(); }});
    });

    // Search + Sort
    $('#search').addEventListener('input', (e)=>{ state.search = e.target.value.trim(); render(); });
    $('#sort').addEventListener('change', (e)=>{ state.sort = e.target.value; render(); });

    // Initial paint
    render();
  </script>
</body>
</html>
